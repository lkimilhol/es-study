# es-study

## index란

|ES|RDBMS|
|------|---|
|index|database|
|mapping|schema|
|document|row|

문서가 저장되는 논리적인 공간
문서를 저장하기 위해서는 반드시 인덱스가 존재해야 함

인덱스를 설계하는 것이 ES를 사용하기 위해 고려해야 하는 첫 단계

## 샤드란
인덱스에 색인되는 문서가 저장되는 공간.
하나의 인덱스는 반드시 하나 이상의 샤드를 가진다.

### 샤드의 종류

프라이머리 샤드: 문서가 저장되는 원본 샤드, 색인과 검색 성능에 모두 영향을 줌
레플리키 샤드: 프라이머리 샤드의 복제 샤드, 검색 성능에 영향을 줌. 프라이머리 샤드에 문제가 생기면 레플리카 샤드가 프라이머리 샤드로 승격

```
PUT /library/_settings
{
 "index": {
  "number_of_shards": 3,
  "number_of_replicas": 1
 }
}
```

프라이머리 샤드3개 레플리카 샤드 총 3대 (프라이머리 샤드 1개당 레플리카가 1개) -> 총 6대

```
PUT /library/_settings
{
 "index": {
  "number_of_shards": 5,
  "number_of_replicas": 2
 }
}
```

프라이머리 샤드5개 레플리카 샤드 총 10대 (프라이머리 샤드 1개당 레플리카가 2개) -> 총 15대

### 샤드의 라우팅

샤드의 라우팅은 문서 저장 방법. 샤드의 개수가 바뀌면 문서가 저장되는 규칙이 완전히 바뀌게 됨
Routing Rule = (문서의 ID) % (샤드의 개수)

중간에 샤드가 바뀌면 룰이 바뀌고 인덱스의 프라이머리 샤드는 만들고 나서 변경이 불가능

인덱스 생성할 때 프라이머리 샤드의 개수를 설정하는것이 매우 중요 -> 바꿀 수가 없기 때문

number_of_shards의 기본값은 1


## 인덱스 템플릿
인덱스 템플릿을 만들고 인덱스 패턴을 만들어서 nginx-log로 시작하는 모든 인덱스의 샤드 개수를 지정 가능
